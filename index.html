<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>App Inventor Fusion Studio</title>
    <script src="https://cdn.jsdelivr.net/npm/monaco-editor@0.34.1/min/vs/loader.js"></script>
    <script src="https://kit.fontawesome.com/a076d05399.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            height: 100vh;
            background-color: #1e1e1e;
            color: #dcdcdc;
        }

        #container {
            display: flex;
            flex: 1;
            min-height: 80vh;
            margin-top: 10px;
        }

        #editor-container {
            flex: 1;
            background-color: #1e1e1e;
            color: white;
            padding: 10px;
            border-radius: 5px;
        }

        #file-tree {
            width: 200px;
            background: #2d2d2d;
            padding: 10px;
            overflow-y: auto;
            border-radius: 5px;
            margin-left: 10px;
        }

        button {
            padding: 10px 20px;
            margin-top: 20px;
            cursor: pointer;
            background-color: #007acc;
            border: none;
            color: white;
            font-size: 16px;
            border-radius: 5px;
        }

        .github-corner {
            position: absolute;
            top: 0;
            right: 0;
            width: 50px;
            height: 50px;
            background-color: transparent;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 20px;
            text-decoration: none;
        }

        .github-corner i {
            color: white;
        }

        #fileList {
            list-style-type: none;
            padding: 0;
        }

        #fileList li {
            padding: 5px;
            cursor: pointer;
            margin: 2px 0;
            background-color: #3b3b3b;
            border-radius: 5px;
        }

        #fileList li:hover {
            background-color: #007acc;
        }

        .button-container {
            display: flex;
            justify-content: space-around;
            margin-top: 50px;
        }
    </style>
</head>
<body>

    <a href="https://github.com/SirHumza/AppInventor-Fusion/" 
       target="_blank" 
       class="github-corner">
        <i class="fab fa-github"></i>
        <span class="github-text">Made by SirHumza</span>
    </a>

    <div class="button-container">
        <button id="newAppBtn">New App</button>
        <button id="importFileBtn">Import File</button>
        <button id="openSavedBtn">Open Saved</button>
    </div>

    <div id="container">
        <div id="file-tree">
            <h3>Files</h3>
            <ul id="fileList"></ul>
        </div>
        <div id="editor-container"></div>
    </div>

    <script>
        // Store files in memory (simulating a backend for this demo)
        const projectFiles = {
            'index.html': '<html><body><h1>Hello World!</h1></body></html>',
            'script.js': 'console.log("Hello World!");',
            'style.css': 'body { background-color: lightblue; }',
            'project.bky': '/* Blockly code here */',
            'screen.scm': '/* Screen layout code here */'
        };

        const fileTree = document.getElementById('fileList');
        let currentFile = '';
        let editor;
        let autoSaveInterval;

        // Monaco Editor Initialization
        require.config({ paths: { 'vs': 'https://cdn.jsdelivr.net/npm/monaco-editor@0.34.1/min/vs' } });
        require(['vs/editor/editor.main'], function () {
            editor = monaco.editor.create(document.getElementById('editor-container'), {
                value: '',
                language: 'javascript',
                theme: 'vs-dark',
                automaticLayout: true
            });
        });

        // Autosave functionality every 10 seconds
        function autoSave() {
            if (currentFile && (currentFile.endsWith('.scm') || currentFile.endsWith('.bky'))) {
                const updatedContent = editor.getValue();
                projectFiles[currentFile] = updatedContent;
                console.log("Auto-saved:", currentFile);
            }
        }

        // Start autosave every 10 seconds
        function startAutoSave() {
            if (autoSaveInterval) {
                clearInterval(autoSaveInterval);
            }
            autoSaveInterval = setInterval(autoSave, 10000); // Autosave every 10 seconds
        }

        // Load file content into the editor
        function openFile(fileName) {
            currentFile = fileName;
            const fileContent = projectFiles[fileName];
            editor.setValue(fileContent);
            startAutoSave(); // Start autosave when file is opened
        }

        // Save file content when changes occur
        editor.onDidChangeModelContent(() => {
            const updatedContent = editor.getValue();
            if (currentFile) {
                projectFiles[currentFile] = updatedContent; // Save to in-memory files
            }
        });

        // Button Actions
        document.getElementById('newAppBtn').addEventListener('click', () => {
            alert("Creating a new App...");
            // Logic for creating a new app
            projectFiles['newApp.html'] = '<html><body><h1>New App</h1></body></html>';
            refreshFileTree();
        });

        document.getElementById('importFileBtn').addEventListener('click', () => {
            alert("Importing a file...");
            // Logic for importing files, simulation only
            projectFiles['importedFile.js'] = 'console.log("Imported File");';
            refreshFileTree();
        });

        document.getElementById('openSavedBtn').addEventListener('click', () => {
            alert("Opening saved project...");
            // Logic for opening a saved project (demoing with in-memory files)
            refreshFileTree();
        });

        // Refresh file tree display
        function refreshFileTree() {
            fileTree.innerHTML = '';
            Object.keys(projectFiles).forEach(fileName => {
                const li = document.createElement('li');
                li.textContent = fileName;
                li.addEventListener('click', () => openFile(fileName));
                fileTree.appendChild(li);
            });
        }

        // Initialize file tree
        refreshFileTree();
    </script>

</body>
</html>
